{% extends "wagtailadmin/base.html" %}
{% load static i18n wagtailadmin_tags %}

{% block titletag %}{% blocktrans with title=page.get_admin_display_title %}Comparing {{ title }}{% endblocktrans %}{% endblock %}


{% block content %}
    {% trans "Comparing" as comparing_str %}
    {% include "wagtailadmin/shared/header.html" with title=comparing_str subtitle=page.get_admin_display_title icon="doc-empty-inverse" %}

    <div class="nice-padding">
        <a href="{% url 'wagtailadmin_pages:edit' page.id %}">{% trans "Edit this page" %}</a> |
        <a href="{% url 'wagtailadmin_pages:revisions_index' page.id %}">{% trans "View revisions" %}</a>
    </div>

    <ul class="comparison">
        {% for comp in comparison %}
        <li>
            <div class="comparison__field">
                <label class="comparison__field-label">{{ comp.field_label }}:</label>
                <div class="comparison__field-content">
                    {% if comp.is_field %}
                        {{ comp.htmldiff }}
                    {% elif comp.is_child_relation %}
                        {% for child_comp in comp.get_child_comparisons %}
                            <div class="comparison__child-object {% if child_comp.is_addition %}addition{% elif child_comp.is_deletion %}deletion{% endif %}">
                                {% with child_comp.get_position_change as move %}
                                    {% if move %}
                                        {% if move > 0 %}
                                            {% blocktrans count counter=move %}
                                                Moved down 1 place.
                                            {% plural %}
                                                Moved down {{ counter }} places.
                                            {% endblocktrans %}
                                        {% elif move < 0 %}
                                            {% blocktrans count counter=move|abs %}
                                                Moved up 1 place.
                                            {% plural %}
                                                Moved up {{ counter }} places.
                                            {% endblocktrans %}
                                        {% endif %}
                                    {% endif %}
                                {% endwith %}

                                <dl>
                                    {% for field_comp in child_comp.get_field_comparisons %}
                                        <dt>{{ field_comp.field_label }}</dt>
                                        <dd>{{ field_comp.htmldiff }}</dd>
                                    {% endfor %}
                                </dl>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </li>
        {% empty %}
            <h3>{% trans "There are no differences between these two revisions" %}</h3>
        {% endfor %}
    </ul>
{% endblock %}


{% block extra_css %}
    {{ block.super }}

    <link rel="stylesheet" href="{% static 'wagtailadmin/css/layouts/compare-revisions.css' %}" type="text/css" />
{% endblock %}
